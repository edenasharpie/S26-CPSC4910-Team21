# readOnly properties are auto-generated by the system
# writeOnly properties are only accepted in requests,
# and never returned in responses (for sensitive data)

# base account schema with common properties for all user account types
Account:
  type: object
  description: Base schema for user accounts, containing common properties for all account types (drivers, sponsors, admins)
  required:
    # user must enter these fields when creating an account
    - username
    - password
    - email
    - firstName
    - lastName
  properties:
    id:
      type: string
      description: Unique identifier for the account
      format: uuid
      readOnly: true
    username:
      type: string
      description: Unique username for the account
      minLength: 3
      maxLength: 25
      example: johndoe123
    password:
      type: string
      description: Password for the account
      format: password
      minLength: 8
      maxLength: 32
      writeOnly: true
      example: StrongP@ssw0rd!
    email:
      type: string
      description: Email address associated with the account
      format: email
      example: johndoe@example.com
    phone:
      type: string
      description: Phone number associated with the account
      pattern: '^\+?[1-9]\d{1,14}$'
      example: +1234567890
    firstName:
      type: string
      description: First name of the user
      minLength: 1
      maxLength: 50
      example: John
    middleName:
      type: string
      description: Middle name of the user (optional)
      minLength: 1
      maxLength: 50
      example: Michael
    lastName:
      type: string
      description: Last name of the user
      minLength: 1
      maxLength: 50
      example: Doe
    pronouns:
      type: string
      description: Pronouns of the user
      minLength: 2
      maxLength: 16
      example: she/her
    accountType:
      type: string
      description: Type of the account
      enum:
        - driver
        - sponsor
        - admin
      readOnly: true
      example: driver
    profilePicture:
      type: string
      description: URL to the user's profile picture
      format: uri
      example: https://example.com/images/johndoe.jpg
    bio:
      type: string
      description: Short biography of the user
      maxLength: 500
      example: Driver with 5 years of experience
    activeStatus:
      type: boolean
      description: Indicates whether the account is active
      default: true
      readOnly: true
      example: true
    lastLogin:
      type: string
      description: Timestamp of the last login
      format: date-time
      readOnly: true
      example: 2024-01-15T13:45:30Z
    lastPasswordChange:
      type: string
      description: Timestamp of the last password change
      format: date-time
      readOnly: true
      default: null
      example: 2024-01-10T09:20:15Z
    permissions:
      readOnly: true
      allOf:
        - $ref: './permissions.yaml#/Permissions'

DriverAccount:
  type: object
  description: Driver account with specific properties
  allOf:
    - $ref: '#/Account'
    - type: object
      required:
        - licenseNumber
      properties:
        licenseNumber:
          type: string
          description: Driver's license ID number
          minLength: 5
          maxLength: 20
          example: D1234567
        pointBalance:
          type: number
          description: Driver's current point balance
          minimum: 0
          default: 0
          readOnly: true
          example: 1500
        performanceStatus:
          type: string
          description: Driver's performance status
          enum:
            - excellent
            - good
            - average
            - poor
          readOnly: true
          example: good
        sponsorCompany:
          type: string
          description: Name of the sponsor company associated with the driver (if any)
          minLength: 2
          maxLength: 100
          readOnly: true
          example: FastRides Inc.
        permissions:
          readOnly: true
          allOf:
            - $ref: './permissions.yaml#/DriverPermissions'

SponsorAccount:
  type: object
  description: Sponsor account with specific properties
  allOf:
    - $ref: '#/Account'
    - type: object
      required:
        - username 
        - password
        - companyName
      properties:
        companyName:
          type: string
          description: Name of the sponsor company
          minLength: 2
          maxLength: 100
          readOnly: true
          example: FastRides Inc.
        pointValueRatio:
          type: number
          format: float
          description: "Conversion rate for points (ex: 1 USD = 100 points)"
          default: 100.0
        profileDescription:
          type: string
          description: "Bio or description of Sponsor's organization"
          maxLength: 500
        permissions:
          readOnly: true
          allOf:
            - $ref: './permissions.yaml#/SponsorPermissions'

AdminAccount:
  type: object
  description: Admin account with specific properties
  allOf:
    - $ref: '#/Account'
    - type: object
      properties:
        permissions:
          readOnly: true
          allOf:
            - $ref: './permissions.yaml#/AdminPermissions'

PasswordChangeRequest:
  type: object
  description: Request schema for changing a user's password, requiring the current password hash and the new password hash (with confirmation)
  required:
    - currentPasswordHash
    - newPasswordHash
  properties:
    currentPasswordHash:
      type: string
      format: hash
    newPasswordHash:
      type: string
      minLength: 8
      maxLength: 32
      format: hash
    confirmNewPasswordHash:
      type: string
      minLength: 8
      maxLength: 32
      format: hash

ProfileUpdateRequest:
  type: object
  description: Request schema for updating a user's profile information, allowing changes to personal details and contact information
  properties:
    username:
      type: string
      description: Unique username for the account
      minLength: 3
      maxLength: 25
      example: johndoe123
    email:
      type: string
      description: Email address associated with the account
      format: email
      example: johndoe@example.com
    phone:
      type: string
      description: Phone number associated with the account
      pattern: '^\+?[1-9]\d{1,14}$'
      example: +1234567890
    firstName:
      type: string
      description: First name of the user
      minLength: 1
      maxLength: 50
      example: John
    middleName:
      type: string
      description: Middle name of the user (optional)
      minLength: 1
      maxLength: 50
      example: Michael
    lastName:
      type: string
      description: Last name of the user
      minLength: 1
      maxLength: 50
      example: Doe
    pronouns:
      type: string
      description: Pronouns of the user
      minLength: 2
      maxLength: 16
      example: she/her
    profilePicture:
      type: string
      description: URL to the user's profile picture
      format: uri
      example: https://example.com/images/johndoe.jpg
    bio:
      type: string
      description: Short biography of the user
      maxLength: 500
      example: Driver with 5 years of experience

AccountStatusRequest:
  type: object
  description: Request schema for changing a user's account status (active/inactive), with a reason for the change
  required:
    - activeStatus
  properties:
    activeStatus:
      type: boolean
      description: Status to set for the account (true for active, false for deactivated)
      example: true
    reason:
      type: string
      description: Note on why the status is being changed
      maxLength: 250

UserSummary:
  type: object
  description: Summary information for a user account, for lists and overviews
  properties:
    id:  
      type: string
      format: uuid
    username:
      type: string
    email:
      type: string
      format: email
    firstName:
      type: string
    lastName:
      type: string
    accountType: 
      type: string
      enum: [driver, sponsor, admin]
    activeStatus:
      type: boolean
    lastLogin:
      type: string
      format: date-time
    associatedEntity:
      type: string
      description: Company name for drivers/sponsors, or 'system' for admins

UserManagementList:
  type: object
  description: List of user summaries with pagination information
  properties:
    users:
      type: array
      items:
        $ref: '#/UserSummary'
    totalCount: { type: integer }
    page: { type: integer }